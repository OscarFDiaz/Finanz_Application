<ons-page id="themeSelector">
  <ons-toolbar id="toolbar" class="toolbar" modifier="transparent">
    <ons-back-button></ons-back-button>
    <div class="center labelToolbar" id="titleConfigurarion">
      TEMAS
    </div>
  </ons-toolbar>

  <ons-card style="height: 33%; margin: 16px;">
    <ons-carousel swipeable auto-scroll overscrollable id="carousel" style="height: 100%;">

      <ons-carousel-item class="themeDefault" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%; color:#ffffff; border-radius: 15px; font-weight: 500;">
          POR DEFECTO
        </div>
      </ons-carousel-item>

      <ons-carousel-item class="themeDark" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%;color:#000000; border-radius: 15px; font-weight: 500;">
          OBSCURO
        </div>
      </ons-carousel-item>

      <ons-carousel-item class="themeLight" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%; color:#000000; border-radius: 15px; font-weight: 500;">
          CLARO
        </div>
      </ons-carousel-item>

      <ons-carousel-item class="themeYuri" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%; columns: #000000; border-radius: 15px; font-weight: 500;">
          YURI
        </div>
      </ons-carousel-item>

      <ons-carousel-item class="themePink" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%; columns: #000000; border-radius: 15px; font-weight: 500;">
          ROSA
        </div>
      </ons-carousel-item>

      <ons-carousel-item class="themeCustom" style="border-radius: 15px;">
        <div style="text-align: center; font-size: 30px; margin-top: 20%; columns: #0d2840; border-radius: 15px; font-weight: 500;">
          PERSONALIZADO
        </div>
      </ons-carousel-item>

    </ons-carousel>
  </ons-card>

  <label class="tutorialLabel"> <- Desliza para cambiar de tema -></label>

  <ons-button id="buttonSelectTheme" class="flatButton" onclick="changeTheme()" style="margin-top: 32px;">
    SELECCIONAR
  </ons-button>

  <div id="editThemeContainer">
  </div>

  <script>
    document.addEventListener(
      "init",
      function (event) {
        if (event.target.matches("#themeSelector")) {

          let currentTheme = localStorage.getItem("userTheme");
          let currentIndex;

          if (currentTheme == null || currentTheme == '') {
            currentIndex = 0;
          } else if (currentTheme == "theme-default") {
            currentIndex = 0;
          } else if (currentTheme == "theme-dark") {
            currentIndex = 1;
          } else if (currentTheme == "theme-light") {
            currentIndex = 2;
          } else if (currentTheme == "theme-yuri") {
            currentIndex = 3;
          } else if (currentTheme == "theme-pink") {
            currentIndex = 4;
          } else if (currentTheme == "theme-custom") {
            currentIndex = 5;
          }

          document.getElementById('carousel').setAttribute('initial-index', currentIndex);
          document.getElementById('carousel').setActiveIndex(currentIndex);

          sessionStorage.setItem("themeIndex", currentIndex);

          activeIndex = document.getElementById('carousel').getActiveIndex();

          if (activeIndex == "5") {
            document.getElementById("editThemeContainer").innerHTML = 
            `<ons-button class="flatButtonLight" onclick="pushToEditTheme()" style="margin-top:16px">
              PERSONALIZAR
            </ons-button>`;
          } else {
            document.getElementById("editThemeContainer").innerHTML = "";
          }

          if (currentIndex == activeIndex) {
            document.getElementById("buttonSelectTheme").innerHTML = "TEMA ACTUAL";
          } else {
            document.getElementById("buttonSelectTheme").innerHTML = "SELECCIONAR";
          }

          // Se ejecuta siempre que el carusel se mueva, esto para setear el bot√≥n que permite personalizar el tema custom
          ons.ready(function () {
            var carousel = document.addEventListener("postchange", function (event) {
              sessionStorage.setItem("themeIndex", event.activeIndex);

              if (event.activeIndex == "5") {
                document.getElementById("editThemeContainer").innerHTML = 
                `<ons-button class="flatButtonLight" onclick="pushToEditTheme()" style="margin-top:16px">
                  PERSONALIZAR
                </ons-button>`;
              } else {
                document.getElementById("editThemeContainer").innerHTML = "";
              }

              let current = localStorage.getItem("userTheme");
              let currentI;

              if (current == null || current == '') {
                currentI = 0;
              }else if (current == "theme-default") {
                currentI = 0;
              } else if (current == "theme-dark") {
                currentI = 1;
              } else if (current == "theme-light") {
                currentI = 2;
              } else if (current == "theme-yuri") {
                currentI = 3;
              } else if (current == "theme-pink") {
                currentI = 4;
              } else if (current == "theme-custom") {
                currentI = 5;
              }

              if (event.activeIndex == currentI) {
                document.getElementById("buttonSelectTheme").innerHTML = "TEMA ACTUAL";
              } else {
                document.getElementById("buttonSelectTheme").innerHTML = "SELECCIONAR";
              }

            });
          });
        }
      },
      false
    );
  </script>
</ons-page>
