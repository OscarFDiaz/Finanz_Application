<ons-page id="detailGoal">
  <ons-toolbar id="toolbar" class="toolbar" modifier="transparent">
    <ons-back-button></ons-back-button>

    <div class="center labelToolbar" id="titleDetailGoal">
      Monitor para jugar a 144 FPS
    </div>
  </ons-toolbar>
  <div id="goalDetailContainer"></div>

  <ons-alert-dialog id="my-alert-dialog" modifier="material">
    <div style="text-align: center; margin-top: 16px;">
      <div class="alert-dialog-title">Modificar meta</div>
    </div>

    <div class="alert-dialog-content">
      <div style="text-align: center; margin-top: 16px;">
        <p>
          <ons-input
            id="editGoalName"
            modifier="underbar"
            placeholder="NOMBRE DE LA META"
            type="text"
            style="display: block; margin: 16px 16px;"
          ></ons-input>

          <textarea
          id="editGoalDescription" 
          class="textarea" 
          rows="5" 
          placeholder="DESCRIPCIÓN"
          ></textarea>

          <ons-input
            id="editGoalMoney"
            modifier="underbar"
            placeholder="DINERO NECESARIO"
            type="number"
            style="display: block; margin: 16px 16px;"
          ></ons-input>

          <ons-input
            id="editActualGoalMoney"
            modifier="underbar"
            placeholder="DINERO ACTUAL"
            type="number"
            style="display: block; margin: 16px 16px;"
          ></ons-input>

          <ons-input
            id="editGoalDate"
            modifier="underbar"
            placeholder="FECHA META"
            type="date"
            style="display: block; margin: 16px 16px;"
          ></ons-input>
        </p>
      </div>
    </div>

    <div class="alert-dialog-footer">
      <ons-alert-dialog-button onclick="hideAlertNoChange()"
        >Cancelar</ons-alert-dialog-button
      >
      <ons-alert-dialog-button onclick="hideAlertDialog()"
        >Listo!</ons-alert-dialog-button
      >
    </div>
  </ons-alert-dialog>

  <!--ALERT PARA EDITAR UNICAMENTE EL DINERO-->
  <ons-alert-dialog id="alertEditGoalMoney" modifier="material">
    <div style="text-align: center; margin-top: 16px;">
      <div class="alert-dialog-title">Modificar meta</div>
    </div>

    <div class="alert-dialog-content">
      <div style="text-align: center; margin-top: 16px;">
        <p>
          <label style="color: var(--text-color-3);">DINERO ACTUAL: $ 
            <label id="editOnlyMoneyActualMoney" style="color: var(--text-color-4)">0</label>
          </label>

          <ons-input
          onchange="makeSum()"
          onkeypress="this.onchange()"
          oninput="this.onchange()"
          id="editOnlyGoalMoney"
          modifier="underbar"
          placeholder="QUIERO AÑADIR"
          type="number"
          style="display: block; margin: -10px auto 16px;"
          ></ons-input>

          <label style="color: var(--text-color-3);">CANTIDAD NUEVA: $ 
            <label id="editOnlyEndMoney" style="color: var(--text-color-4)">0</label>
          </label>
        </p>
      </div>
    </div>

    <div class="alert-dialog-footer">
      <ons-alert-dialog-button onclick="hideAlertNoChangeMoney()"
        >Cancelar</ons-alert-dialog-button
      >
      <ons-alert-dialog-button onclick="hideAlertDialogMoney()"
        >Listo!</ons-alert-dialog-button
      >
    </div>
  </ons-alert-dialog>

  <script>
    document.addEventListener(
      "init",
      function (event) {
        if (event.target.matches("#detailGoal")) {
          document.getElementById("titleDetailGoal").innerHTML = "";

          let retrievedGoal = sessionStorage.getItem("sessionFindGoal");
          let parseGoal = JSON.parse(retrievedGoal);

          let gName = parseGoal.name;
          let gDescription = parseGoal.description;
          let gAMoney = parseGoal.actualMoney;
          let gMoney = parseGoal.goalMoney;
          let gDate = parseGoal.date;

          let gPercent = getPercent(gMoney, gAMoney);

          document.getElementById("titleDetailGoal").innerHTML = gName;

          let goalsView = document.getElementById("goalDetailContainer");
          goalsView.innerHTML = "";

          /*
       TODO 
        - CALCULAR EL PORCENTAJE
        - CALCULAR BIEN LAS FECHAS
       */
          goalsView.innerHTML += `<ons-card>
              <div class="title detailTitle">
                ${gName}
              </div>
              <div class="content detailInfo">
                <p>
                  DESCRIPCIÓN: ${gDescription}
                </p>
              </div>
            </ons-card>
        
            <ons-card>
              <div class="title percentDetailTitle" id="${gName}-pnumber">
                ${gPercent}%
              </div>

              <div class="progressBarContainer percentBar"> 
                <div class="progressBarPercent" style="--width:${gPercent}" id="pbarDetail"></div> 
              </div> 

              <div class="content">
                <label class="moneyDetailGoal" id="detailMoneyStatus">
                  $ ${gAMoney} de $ ${gMoney}
                </label>
                <label class="moneyDetailGoal">
                  ${gDate}
                </label>
                <ons-button class="flatButton" style="margin-top: 16px;" onclick="addMoneyGoal('${gName}')">
                  AÑADIR DINERO
                </ons-button>
              </div>
            </ons-card>

            <ons-button class="flatButtonLight" style="margin-bottom: 16px;" onclick="editGoal('${gName}')">
              EDITAR META
            </ons-button>
            
            <ons-button class="flatButton" style="margin-top: 16px;" onclick="deleteGoal('${gName}')">
                  ELIMINAR META
            </ons-button>`;

        }
      },
      false
    );
  </script>
</ons-page>
