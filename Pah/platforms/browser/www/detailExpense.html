<ons-page id="detailExpense">
  <ons-toolbar id="toolbar" class="toolbar" modifier="transparent">
    <ons-back-button></ons-back-button>

    <div class="center labelToolbar" id="titleDetailExpense">
    </div>
  </ons-toolbar>

  <div id="detailExpenseContainer"></div>

    <!--ALERT PARA EDITAR UN GASTO-->
    <ons-alert-dialog id="alertToEditExpense" modifier="material">
      <div style="text-align: center; margin-top: 16px;">
        <div class="alert-dialog-title">EDITAR GASTO</div>
      </div>
  
      <div class="alert-dialog-content">
        <div style="text-align: center; margin-top: 16px;">
          <p>
            <ons-input
              onchange="changeTitlePreview()"
              onkeypress="this.onchange()"
              oninput="this.onchange()"
              id="newExpenseNameEdit"
              modifier="underbar"
              placeholder="NUEVO NOMBRE"
              type="text"
              style="display: block; margin: 16px 16px;"
            ></ons-input>
  
            <label class="iconExpenseLabel" style="margin-bottom: -20px;">SELECCIONA UN COLOR</label>

            <div style="text-align: center; margin-top: 16px;">
              <p>
                <ons-input
                  onchange="loadIconsEdit()"
                  onkeypress="this.onchange()"
                  oninput="this.onchange()"
                  id="newExpenseColorEdi"
                  type="color"
                  value="#ffffff"
                  style="display: block; margin: 16px 16px; border-radius: 50%x;"
                ></ons-input>
              </p>
            </div>
  
            <ons-list style="background: none; margin-top: -25px;">
              <ons-list-item id="expandableListContainer" expandable>
                <label class="iconExpenseLabel" style="margin-left: 50px;">
                  SELECCIONA UN ICONO
                </label>
                <div class="expandable-content" id="expenseIconListOfIconsEdit"> 
                  <!-- AQUI SE CARGAN LOS ICONOS PARA SELECCIONAR -->
                </div>
              </ons-list-item>
            </ons-list>
          </p>
        </div>
      </div>
  
      <div class="alert-dialog-footer">
        <ons-alert-dialog-button onclick="hideAlertExpenseEditNoChange()"
          >Cancelar</ons-alert-dialog-button
        >
        <ons-alert-dialog-button onclick="hideAlertExpenseEdit()"
          >Listo!</ons-alert-dialog-button
        >
      </div>
    </ons-alert-dialog>
    <!----------------------------------------------------------------->

  <script>
    document.addEventListener(
      "init",
      function (event) {
        if (event.target.matches("#detailExpense")) {
          document.getElementById("detailExpenseContainer").innerHTML = "";

          let retrievedExpense = sessionStorage.getItem("sessionFindGoal");
          let parseExpense = JSON.parse(retrievedExpense);

          let eName = parseExpense.expenseName;
          let eTotal = parseExpense.totalExpense;
          let lExpense = parseExpense.lastExpense;
          let lNote = parseExpense.lastNote;
          let lDate = parseExpense.lastNote;
          let mDate = parseExpense.mainDate;

          let lastFDays, lastTDays;

          if (eTotal == 0) {
            lastFDays = lastTDays = 0;
          } else {
            lastFDays = getAmountFDays();
            lastTDays = getAmountTDays();
          }

          let expenseView = document.getElementById("detailExpenseContainer");
          expenseView.innerHTML = "";
          document.getElementById("titleDetailExpense").innerHTML = eName;

          expenseView.innerHTML += `<ons-card style="padding-bottom:16px">
            <div class="content">
              <label class="labelDetailExpense"
                >Fecha creación:
                <span id="expenseCreationDate" class="labelInfoDetailExpense"
                  >${mDate}</span
                ></label
              >
            </div>
            <ons-button class="flatButton" onclick="editExpense('${eName}')">EDITAR GASTO</ons-button>
          </ons-card>

          <ons-card>
            <div class="content">
              <label class="labelDetailExpense"
                >Gasto total:
                <span id="totalExpenseDetail" class="labelInfoDetailExpense"
                  >$ ${eTotal}</span
                ></label
              >
              <label class="labelDetailExpense"
                >Últimos 15 días:
                <span id="lastDaysDetail" class="labelInfoDetailExpense"
                  >$ ${lastFDays}</span
                ></label
              >
              <label class="labelDetailExpense"
                >Últimos 30 días:
                <span id="lastMonthDetail" class="labelInfoDetailExpense"
                  >$ ${lastTDays}</span
                ></label
              >
            </div>
          </ons-card>
          
          
          <ons-card>
            <ons-list style="background: none;" id="expenseListOfExpensesContainer">
              <ons-list-item
                id="expandableListContainer"
                expandable
                style="margin-top: 0px;"
              >
                <label class="iconExpenseLabel" style="margin-left: 50px;">
                  VER GASTOS
                </label>
                <div
                  class="expandable-content"
                  id="expenseListOfExpenses"
                  style="grid-template-columns: 1fr;"
                >
                  <!-- AQUI SE CARGAN LOS GASTOS -->
                </div>
              </ons-list-item>
            </ons-list>
          </ons-card>
          
          <ons-button class="flatButtonLight" style="margin-bottom: 16px;"
          onclick="resetExpense('${eName}')">REINICIAR</ons-button
          >`;

          let detailDetailExpenseView = document.getElementById(
            "expenseListOfExpenses"
          );
          detailDetailExpenseView.innerHTML = "";

          let expensesDetail = JSON.parse(
            localStorage.getItem("expenseDetailStorage")
          );

          let actualEx = 0;
          if (expensesDetail == null || expensesDetail == "null") {
          } else {
            for (let i = 0; i < expensesDetail.length; i++) {
              if (expensesDetail[i].expenseName == eName) {
                actualEx = 1;
              }
            }
          }

          if (actualEx == 0) {
            detailDetailExpenseView.innerHTML = `<div style="margin-bottom: 30px;">
              <label class="labelDetailExpense">Nada por mostrar, vas bien con los ahorros...</label>
            </div>`;
          } else {
            for (let i = 0; i < expensesDetail.length; i++) {
              if (expensesDetail[i].expenseName == eName) {
                let iName = expensesDetail[i].inName;
                let iAmount = expensesDetail[i].inAmount;
                let iDate = expensesDetail[i].inDate;

                detailDetailExpenseView.innerHTML += `<div style="margin-bottom: 30px;">
                  <label class="labelDetailExpense" style="padding-top: 0px">Nota: <span class="labelInfoDetailExpense">${iName}</span></label>
                  <label class="labelDetailExpense" style="padding-top: 0px">Fecha: <span class="labelInfoDetailExpense">${iDate}</span></label>
                  <label class="labelDetailExpense" style="padding-top: 0px">Total: $ <span class="labelInfoDetailExpense">${iAmount}</span></label>
                  </div>`;
              }
            }
          }
        }
      },
      false
    );
  </script>
</ons-page>
